{"id":121,"date":"2019-03-23T11:28:51","date_gmt":"2019-03-23T16:28:51","guid":{"rendered":"http:\/\/blog.ucadministrator.com\/?p=121"},"modified":"2019-07-02T20:23:23","modified_gmt":"2019-07-03T01:23:23","slug":"neccdc2019-creating-the-port-groups-with-powercli","status":"publish","type":"post","link":"https:\/\/virtualizedtaylor.wpcomstaging.com\/2019\/03\/23\/neccdc2019-creating-the-port-groups-with-powercli\/","title":{"rendered":"Creating the port groups with PowerCLI"},"content":{"rendered":"<p>Now that NECCDC is over, I can share some details on how the environment was setup. More specifically how the virtual networking was setup. We had just about 35 vlans in total and all of them needed to be leveraged in the virtual environment for Red\/White team jump boxes.<\/p>\n<p>I could have manually created 70 port groups across both of the virtual hosts or migrated to distributed switches to only create 35 port groups but where is the fun with that when we can script it?<\/p>\n<p><span style=\"color:var(--color-neutral-600);\">Copying, pasting and increment the same line of code 35 times seemed lame.<\/span><span style=\"color:var(--color-neutral-600);\">\u00a0I leveraged what is know i<\/span>n programming as an array. An array is an ordered list of structured data that allows you to take similar items (vlans in this case) and leverage all of them throughout your code.<\/p>\n<p>With PowerCLI its extremely straight forward to create a port group. After connecting to vCenter with your authorized credentials, you can run the following and substitute the name of your vSwitch, desired name of your port group and vlan id.<\/p>\n<pre>Get-VirtualSwitch -Name \"VSWITCHHERE\" | New-VirtualPortGroup -Name \"NAMEHERE\" -VlanID \"VLANIDHERE\"<\/pre>\n<p>So lets take a look at the final script that was used to build the virtual networking in NECCDC 2019.<\/p>\n<div>\n<pre>#vCenter Server\n$vCenter = \"vcenter.black.beavernado.com\"\n\n#User Credentials\n$Credential = Get-Credential \"$env:USERDOMAIN\\$env:USERNAME\"\n\n#vSwitch to Modify\n$vSwitch = \"vSwitch0\"\n\n#Connection to vCenter\nConnect-VIServer -Server $vCenter -Credential $Credential\n\n#Array of VLANS for Each Blue segment\n$BLUEWANVLAN = 101,102,103,104,105,106,107,108,109,110\n$BLUELANVLAN = 201,202,203,204,205,206,207,208,209,210\n$BLUEDMZVLAN = 301,302,303,304,305,306,307,308,309,310\n\n#Array of VLANS for Competition Staff\n$ADMINVLAN = 200,253,254\n\n#Creation of Blue WAN Port Groups\nForEach ($wanvlan in $BLUEWANVLAN)\n{\n    Get-VirtualSwitch -Name $vSwitch | New-VirtualPortGroup -Name \"BLUE WAN $wanvlan\" -VlanID $wanvlan\n}\n\n#Creation of Blue LAN Port Groups\nForEach ($lanvlan in $BLUELANVLAN)\n{\n    Get-VirtualSwitch -Name $vSwitch | New-VirtualPortGroup -name \"BLUE LAN $lanvlan\" -VlanID $lanvlan\n}\n\n#Creation of Blue DMZ Port Groups\nForEach ($dmzvlan in $BLUEDMZVLAN)\n{\n    Get-VirtualSwitch -Name $vSwitch | New-VirtualPortGroup -name \"BLUE DMZ $dmzvlan\" -VlanID $dmzvlan\n}\n\n#Creation of Admin Port Groups\nForEach ($vlan in $ADMINVLAN)\n{\n    Get-VirtualSwitch -Name $vSwitch | New-VirtualPortGroup -name \"ADMIN $vlan\" -VlanID $vlan\n}\n\n<\/pre>\n<\/div>\n<p>Here is what it does!<\/p>\n<p><em>1: Prompts user to enter password for the logged-in user.\u00a0<\/em><\/p>\n<p><em>2: Connects to vCenter using the defined server, logged-in username and password that you provide to the prompt.<\/em><\/p>\n<p><em>3: Creates Port Groups for all WAN VLANS defined in the BLUEWAN array.<\/em><\/p>\n<p><em>4: Creates Port Groups for all LAN VLANS defined in the BLUELAN array.<\/em><\/p>\n<p><em>5: Creates Port Groups for all DMZ VLANS defined in the BLUEDMZ array.<\/em><\/p>\n<p><em>6: Creates Port Groups for all Admin VLANS defined in the ADMIN array.<\/em><\/p>\n<p>I like to think this was a little more elegant than copying and pasting the same command 35 times.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Now that NECCDC is over, I can share some details on how the environment was setup. More specifically how the virtual networking was setup. We had just about 35 vlans in total and all of them needed to be leveraged in the virtual environment for Red\/White team jump boxes. I could have manually created 70 &hellip; <a href=\"https:\/\/virtualizedtaylor.wpcomstaging.com\/2019\/03\/23\/neccdc2019-creating-the-port-groups-with-powercli\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">Creating the port groups with PowerCLI<\/span> <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":62406288,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_coblocks_attr":"","_coblocks_dimensions":"","_coblocks_responsive_height":"","_coblocks_accordion_ie_support":"","advanced_seo_description":"","jetpack_seo_html_title":"","jetpack_seo_noindex":false,"jetpack_post_was_ever_published":false,"_jetpack_newsletter_access":"","_jetpack_dont_email_post_to_subs":false,"_jetpack_newsletter_tier_id":0,"footnotes":"","jetpack_publicize_message":"","jetpack_publicize_feature_enabled":true,"jetpack_social_post_already_shared":false,"jetpack_social_options":{"image_generator_settings":{"template":"highway","enabled":false}}},"categories":[44070,9204,111833850,19743086,38600],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_likes_enabled":true,"jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/paI6yL-1X","jetpack-related-posts":[],"_links":{"self":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/121"}],"collection":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/users\/62406288"}],"replies":[{"embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/comments?post=121"}],"version-history":[{"count":3,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/121\/revisions"}],"predecessor-version":[{"id":192,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/121\/revisions\/192"}],"wp:attachment":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/media?parent=121"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/categories?post=121"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/tags?post=121"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
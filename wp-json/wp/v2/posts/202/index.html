{"id":202,"date":"2019-09-02T17:01:00","date_gmt":"2019-09-02T22:01:00","guid":{"rendered":"http:\/\/blog.ucadministrator.com\/?p=202"},"modified":"2021-05-16T09:44:38","modified_gmt":"2021-05-16T14:44:38","slug":"virtual-port-channel-vpc-base-configuration","status":"publish","type":"post","link":"https:\/\/virtualizedtaylor.wpcomstaging.com\/2019\/09\/02\/virtual-port-channel-vpc-base-configuration\/","title":{"rendered":"Virtual Port Channel (VPC) &#8211; Base Configuration"},"content":{"rendered":"<h3>Overview:<\/h3>\n<p>In my last post, we talked about some differences between traditional port channels and virtual port channel found on the Nexus line of switches. If you have not seen it, make sure to check it out <a href=\"http:\/\/blog.ucadministrator.com\/2019\/08\/06\/virtual-port-channel-i-though-it-was-port-channel\/\">here<\/a>. Now that you understand some differences, its time to jump into the required configuration.<\/p>\n<h3>Configuration:<\/h3>\n<p>There are a few main steps that need to be done to configure VPC. The first step is to enable the VPC feature. This is done with the following command and will need to be done on both switches.<\/p>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch(config)#feature vpc<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>Once the feature has been enabled. Its time to create the VPC Domain. The commands are shown below. Replace xxx.xxx.xxx.xxx and yyy.yyy.yyy.yyy with the IP address of your switch. Each switch will have these addresses reversed as the source and destination will change.<\/p>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch1(config)#vpc domain 1<\/h6>\n<h6>NexusSwitch1(config-vpc-domain)#role priority 24576<\/h6>\n<h6>NexusSwitch1(config-vpc-domain)#peer-keepalive destination xxx.xxx.xxx.xxx source yyy.yyy.yyy.yyy<\/h6>\n<h6>NexusSwitch1(config-vpc-domain)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch2(config)#vpc domain 1<\/h6>\n<h6>NexusSwitch2(config-vpc-domain)#role priority 28672<\/h6>\n<h6>NexusSwitch2(config-vpc-domain)#peer-keepalive destination yyy.yyy.yyy.yyy source xxx.xxx.xxx.xxx<\/h6>\n<h6>NexusSwitch2(config-vpc-domain)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>The priority value should be different between both of your switches. I typically use the same values as STP. This is more of an OCD thing for me&#8230; There is absolutely no requirement to do this and remember that the switch with the lower value will become primary.<\/p>\n<p>Once the domain has been created. Its time to create the peer-link. It can be done with the following commands:<\/p>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch(config)#interface port-channel1<\/h6>\n<h6>NexusSwitch(config-if)#description VPC Peer-Link<\/h6>\n<h6>NexusSwitch(config-if)#switchport mode trunk<\/h6>\n<h6>NexusSwitch(config-if)#spanning-tree port type network<\/h6>\n<h6>NexusSwitch(config-if)vpc peer-link<\/h6>\n<h6>NexusSwitch(config-if)#no shutdown<\/h6>\n<h6>NexusSwitch(config-if)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch(config)#interface ethernet1\/31-32<\/h6>\n<h6>NexusSwitch(config-if)#description VPC Peer-Link<\/h6>\n<h6>NexusSwitch(config-if)#switchport<\/h6>\n<h6>NexusSwitch(config-if)#switchport mode trunk<\/h6>\n<h6>NexusSwitch(config-if)channel-group 1 mode active<\/h6>\n<h6>NexusSwitch(config-if)#no shutdown<\/h6>\n<h6>NexusSwitch(config-if)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>This configuration needs to be identical on both switches. Any variation (outside of the description and interface number) can cause a consistency&nbsp;failure and the VPC to not be established.<\/p>\n<p>&nbsp;<\/p>\n<p>The next and final step is to configure the Keepalive. You can use any interface for the keepalive including the MGMT0 Interface. Be aware that if you use the Management interface you will have to specify the Management VRF on the peer-keepalive command within the VPC domain.<\/p>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch1(config)#interface ethernet1\/30<\/h6>\n<h6>NexusSwitch1(config-if)#description VPC Keep-Alive<\/h6>\n<h6>NexusSwitch1(config-if)# ip address yyy.yyy.yyy.yyy\/yy<\/h6>\n<h6>NexusSwitch1(config-if)#no shutdown<\/h6>\n<h6>NexusSwitch1(config-if)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch2(config)#interface ethernet1\/30<\/h6>\n<h6>NexusSwitch2(config-if)#description VPC Keep-Alive<\/h6>\n<h6>NexusSwitch2(config-if)# ip address xxx.xxx.xxx.xxx\/xx<\/h6>\n<h6>NexusSwitch2(config-if)#no shutdown<\/h6>\n<h6>NexusSwitch2(config-if)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>You do have the ability and it is recommended to configure the KeepAlive with a port channel. This will give you redundancy if a cable or port ever fails. In the event, you want to use a different VRF for the keep-alive link you can do so with the following configuration. Remember to add that VRF to the keep-alive command within the VPC domain.<\/p>\n<p>&nbsp;<\/p>\n<blockquote>\n<h6>NexusSwitch(config)#vrf context KEEPALIVE<\/h6>\n<h6>NexusSwitch(config-vrf)#exit<\/h6>\n<h6>NexusSwitch(config)#interface ethernet1\/30<\/h6>\n<h6>NexusSwitch(config-if)#description VPC Keep-Alive<\/h6>\n<h6>NexusSwitch(config-if)#vrf member KEEPALIVE<\/h6>\n<h6>NexusSwitch(config-if)# ip address xxx.xxx.xxx.xxx\/xx<\/h6>\n<h6>NexusSwitch(config-if)#no shutdown<\/h6>\n<h6>NexusSwitch(config-if)#exit<\/h6>\n<\/blockquote>\n<p>&nbsp;<\/p>\n<p>This configuration should get you up and running and allow you to create virtual port channels. In the next post, we will go over some additional configuration you can add to the VPC Domain like the peer-switch command to manipulate and improve STP convergence.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Overview: In my last post, we talked about some differences between traditional port channels and virtual port channel found on the Nexus line of switches. If you have not seen it, make sure to check it out here. Now that you understand some differences, its time to jump into the required configuration. Configuration: There are &hellip; <a href=\"https:\/\/virtualizedtaylor.wpcomstaging.com\/2019\/09\/02\/virtual-port-channel-vpc-base-configuration\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">Virtual Port Channel (VPC) &#8211; Base Configuration<\/span> <span class=\"meta-nav\">&rarr;<\/span><\/a><\/p>\n","protected":false},"author":62406288,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_coblocks_attr":"","_coblocks_dimensions":"","_coblocks_responsive_height":"","_coblocks_accordion_ie_support":"","advanced_seo_description":"","jetpack_seo_html_title":"","jetpack_seo_noindex":false,"jetpack_post_was_ever_published":false,"_jetpack_newsletter_access":"","_jetpack_dont_email_post_to_subs":false,"_jetpack_newsletter_tier_id":0,"footnotes":"","jetpack_publicize_message":"Virtual Port Channel (VPC) Base Configuration #cisco #nexus #networking #homelab","jetpack_publicize_feature_enabled":true,"jetpack_social_post_already_shared":false,"jetpack_social_options":{"image_generator_settings":{"template":"highway","enabled":false}}},"categories":[28532,7426,22008,943376],"tags":[],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"","jetpack_likes_enabled":true,"jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/paI6yL-3g","jetpack-related-posts":[],"_links":{"self":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/202"}],"collection":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/users\/62406288"}],"replies":[{"embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/comments?post=202"}],"version-history":[{"count":14,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/202\/revisions"}],"predecessor-version":[{"id":416,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/posts\/202\/revisions\/416"}],"wp:attachment":[{"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/media?parent=202"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/categories?post=202"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/virtualizedtaylor.wpcomstaging.com\/wp-json\/wp\/v2\/tags?post=202"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}